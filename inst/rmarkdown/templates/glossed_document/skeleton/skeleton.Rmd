---
title: "Glossed document by phonfieldwork [Moroz 2020]"
params:
  data: your_file.csv
editor_options: 
  chunk_output_type: console
---

```{r make_viewer, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
df <- read.csv(params$data, stringsAsFactors = FALSE)

library(dplyr)
library(tidyr)
df %>%
  group_by(text_title, p_id, s_id, free_trans, word) %>%
  summarise(words = paste0(txt, collapse = ""),
            gls = paste0(gls, collapse = "-")) %>%
  group_by(text_title, p_id, s_id, free_trans) %>%
  summarise(words = paste0(words, collapse = "&#x09;"),
            gls = paste0(gls, collapse = "&#x09;")) %>% 
  mutate(words = paste0(s_id, "\\.&#x09;", words, "\n\n&#x09;"),
         gls = paste0(gls, "\n\n&#x09;"),
         free_trans = paste0(free_trans, "\n\n")) %>% 
  select(text_title, p_id, s_id, words, gls, free_trans) %>% 
  ungroup() %>% 
  add_row(tibble(text_title = unique(.$text_title),
                   p_id = 0,
                   s_id = 0,
                   words = paste0("\n\n## ", unique(.$text_title), "\n\n"),
                   gls = NA,
                   free_trans = NA), .before = 1) %>% 
  arrange(text_title, p_id, s_id) %>% 
  pivot_longer(names_to = "type", values_to = "value", words:free_trans) %>% 
  na.omit() %>% 
  ungroup() %>% 
  select(value) %>% 
  unlist() %>% 
  unname() %>% 
  cat(sep = "")
```
