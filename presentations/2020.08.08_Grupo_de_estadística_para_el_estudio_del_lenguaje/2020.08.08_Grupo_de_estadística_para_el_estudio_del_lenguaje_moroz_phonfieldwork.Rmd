---
title: "Phonetic fieldwork and experiments with the `phonfieldwork` package for R"
author: "George Moroz"
institute: "Linguistic Convergence Laboratory, NRU HSE"
date: |
    | 08 August 2020, Grupo de estad√≠stica para el estudio del lenguaje
    |
    |
    | Presentation is available here: \alert{tinyurl.com/y6lf5ch4}
    | ![](images/01_qrcode.png)'
output: 
  beamer_presentation:
    latex_engine: xelatex
    citation_package: natbib
    keep_tex: false
    includes:
      in_header: "config/presento.sty"
bibliography: bibliography.bib
biblio-style: "apalike"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# library(qrcode)
# png(filename="images/01_qrcode.png", width = 200, height = 200)
# qrcode_gen("https://github.com/agricolamz/phonfieldwork/raw/master/presentations/2020.08.08_Grupo_de_estad%C3%ADstica_para_el_estudio_del_lenguaje/2020.08.08_Grupo_de_estad%C3%ADstica_para_el_estudio_del_lenguaje_moroz_phonfieldwork.pdf")
# dev.off()

unlink("data/s1", recursive = TRUE)
unlink("data/s2", recursive = TRUE)
dir.create("data/s1")
dir.create("data/s2")
file.copy(paste0("../backup/s1/", list.files("../backup/s1/")), "data/s1/")
file.copy(paste0("../backup/s2/", list.files("../backup/s2/")), "data/s2/")
```

# Introduction

## Most phonetic research consists of the following steps:

1. Formulate a research question. Think of what kind of data is necessary to answer this question, what is the appropriate amount of data, what kind of annotation you will do, what kind of statistical models and visualizations you will use, etc.
2. Create a list of stimuli.
3. Elicite list of stimuli from speakers who signed an Informed Consent statement, agreeing to participate in the experiment to be recorded on audio and/or video.
4. Annotate the collected data.
5. Extract the information from annotated data.
6. Create visualizations.
7. Evaluate your statistical models.
8. Report your results.
9. Publish your data. \pause

The `phonfieldwork` package is created for helping with items 3, 4 (partially), 5, 6, and 9.

## Why/when do you need the phonfieldwork package?

These ideal plan hides some technical subtasks:

* creating a presentation for elicitation task
* renaming and concatenating multiple sound files
* automatic annotation in Praat TextGrids [@boersma19]
* creating a searchable `.html` table with annotations, spectrograms and ability to hear sound
* converting multiple formats (Praat, ELAN [@brugman04] and EXMARaLDA [@schmidt09]) \pause

All of these tasks can be solved by a mixture of different tools:

* any programming language can handle automatic file renaming
* Praat contains scripts for concatenating and renaming files \pause

`phonfieldwork` provides a functionality that will make it easier to solve those tasks independently of any additional tools. You can also compare the functionality with other packages: `rPraat` [@borzil16], `textgRid` [@reidy16], `pympi` [@lubbers13]

## Philosophy of the `phonfieldwork` package

* each stimulus is a separate file
* researcher carefully listens to consultants to make sure that they are producing the kind of speech they wanted
* in case a speaker does not produce clear repetitions, researcher ask them to repeat the task

There are some phoneticians who prefer to record everything for language documentation purposes. I think that should be a separate task. If you insist on recording everything, it is possible to run two recorders at the same time: one could run during the whole session, while the other is used to produce small audio files. You can also use special software to record your stimuli automatically on a computer (e.g. `PsychoPy` [@peirce19]).
   
# Installation of the package

## Install `phonfieldwork`

`phonfieldwork` is an R package, so you need to install [R](https://cloud.r-project.org/), [RStudio](https://rstudio.com/products/rstudio/download/#download) (optional) or use [rstudio.cloud](rstudio.cloud). There are two possibilities for installing package in R:

* official version from CRAN

```{r, eval = FALSE}
install.packages("phonfieldwork")
```

* development version from GitHub

```{r, eval = FALSE}
devtools::install_github("agricolamz/phonfieldwork")
```

\pause

Since this package is under [rOpenSci review](https://github.com/ropensci/software-review/issues/385) there is a chance that in couple months the adress could be changed to `ropensci/phonfieldwork`, and documentation page will be moved from [agricolamz.github.io/phonfieldwork](agricolamz.github.io/phonfieldwork) to
[docs.ropensci.org/phonfieldwork](docs.ropensci.org/phonfieldwork).

```{r}
library("phonfieldwork")
packageVersion("phonfieldwork") # Unreleased version
```

# Creating your presentation

##   Make a list of your stimuli

There are several ways to enter information about a list of stimuli into R:

* list them with the `c()` command

```{r}
my_stimuli <- c("tip", "tap", "top")
```

* read from `.csv` file with the `read.csv()` function:

```{r, eval = FALSE}
my_stimuli_df <- read.csv("my_stimuli_df.csv")
```

* read from `.xls` or `.xlsx` file with the `read_xls()` or `read_xlsx()` function from the `readxl` package (run `install.packages("readxl")` in case you don't have it installed):

```{r, eval = FALSE}
library("readxl")
my_stimuli_df <- read_xlsx("my_stimuli_df.xlsx")
```


##  Create a presentation based on a list of stimuli

# Data renaming

## Obtained data

After collecting data and removing soundfiles with unsuccesful elicitations, one could end up with the following structure:

```{bash, echo = FALSE}
tree data | tail -n 10 | head -n 8
```

## Rename collected data

```{r}
rename_soundfiles(stimuli = my_stimuli, # it is "tip" "tap" "top"
                  prefix = "s1_",
                  path = "data/s1/")
```

```{bash, echo = FALSE}
tree data | tail -n 14 | head -n 12
```

## Rename collected data

```{r}
rename_soundfiles(stimuli = my_stimuli, # it is "tip" "tap" "top"
                  prefix = paste0(1:3, "_"),
                  suffix = "_s2",
                  path = "data/s2/",
                  backup = FALSE)
```

```{bash, echo = FALSE}
tree data | tail -n 14 | head -n 12
```

## Rename collected data

Sometimes it is better to keep and order that will deal with the computer sorting:

```{r}
add_leading_symbols(1:105)
```

So it is better to use the result of `add_leading_symbols()` as a prefix during the renaming of a huge amount of files.

## Get sound duration

Sometimes it is useful to get information about sound duration:

```{r}
get_sound_duration("data/s1/s1_tap.wav")
```

```{r}
get_sound_duration(sounds_from_folder = "data/s2/")
```

# Data merging

# Data annotation

# Data extraction

# Data visulization

# Reading data from different linguistic sources

# Creating a data viewer -- template for the data sharing

# Get help and cite

## Get help and cite

You can always write an email or open an [issue on GitHub](https://github.com/agricolamz/phonfieldwork/issues), asking some questions.

The most recent citation information is avalible with this command:

```{r}
citation("phonfieldwork")
```

# References {.allowframebreaks}
